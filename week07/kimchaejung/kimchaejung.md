# ìƒˆë¡­ê²Œ ì•Œê²Œëœ ì 

## ì»¨í…Œì´ë„ˆ ë°°í¬ ì‹œ ì£¼ì˜í•  ì 

- ë°”ì¸ë“œ ë§ˆìš´íŠ¸ëŠ” í”„ë¡œë•ì…˜ ë‹¨ê³„ ë•Œ ì“°ì§€ ë§ˆë¼!
- ì»¨í…Œì´ë„ˆí™” ëœ ì•±ì€ ë¹Œë“œ ì ˆì°¨ê°€ ì¶”ê°€ì ìœ¼ë¡œ í•„ìš”í•˜ë‹¤!
- ë‹¤ì¤‘ ì»¨í…Œì´ë„ˆ í”„ë¡œì íŠ¸ëŠ” í”„ë¡œì íŠ¸, ì»¨í…Œì´ë„ˆì— ë”°ë¼ ë¶„í• ì—¬ë¶€ê°€ ê²°ì •ëœë‹¤!
- ë°°í¬ í”Œë ›í¼ì„ ëœ í†µì œí•˜ëŠ” ë” ì‰¬ìš´ ì†”ë£¨ì…˜ì„ ì°¾ì„ ìˆ˜ ìˆë‹¤!
  - ì œì–´ - ì±…ì„ì€ íŠ¸ë ˆì´ë“œì˜¤í”„ ê´€ê³„ì— ë†“ì—¬ìˆë‹¤

> Standalone refers to a system or device that can operate independently, without external connections or dependencies. It can perform its intended functions without relying on other devices or networks.<br>
> Standaloneì€ ì™¸ë¶€ ì—°ê²° ë˜ëŠ” ì˜ì¡´ì„±ì—†ì´ ë…ë¦½ì ìœ¼ë¡œ êµ¬ë™í•  ìˆ˜ ìˆëŠ” ì‹œìŠ¤í…œ ë˜ëŠ” ê¸°ê¸°ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤. ë‹¤ë¥¸ ê¸°ê¸° ë‚´ì§€ ë„¤íŠ¸ì›Œí¬ì— ì˜ì¡´í•˜ì§€ ì•Šê³  ì˜ë„ëœ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
> <br> > [lenovo - What is a standalone system or device?](https://www.lenovo.com/us/en/glossary/standalone/?orgRef=https%253A%252F%252Fwww.google.com%252F)

## ë°°í¬ í”„ë¡œì„¸ìŠ¤

> ğŸ§‘â€ğŸ’» Standalone NodeJS App

1. Image, Container ìƒì„±
2. remote host(SSH)ì— Docker ì„¤ì¹˜
3. remote hostì— push, pull ì´ë¯¸ì§€
4. ì»¨í…Œì´ë„ˆ ì‹¤í–‰ í›„ ë¸Œë¼ìš°ì € í…ŒìŠ¤íŠ¸

## í˜¸ìŠ¤íŒ… í”„ë¡œë°”ì´ë”

(í˜„ì¬ëŠ” ë²¤ë”Vendor, í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤Cloud Serviceë¼ê³  ë¶ˆë¦°ë‹¤)

- AWS
- Microsoft Azure
- Google Cloud
- (êµ­ë‚´) ë„¤ì´ë²„ í´ë¼ìš°ë“œ

## AWS EC2ì— ë°°í¬í•˜ëŠ” ë‹¨ê³„

1. EC2 ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•œë‹¤

   VPC, ë³´ì•ˆê·¸ë£¹ë„ ì„¤ì •í•œë‹¤

2. ëª¨ë“  í¬íŠ¸ë¥¼ WWWì— ë…¸ì¶œì‹œí‚¤ë„ë¡ ë³´ì•ˆ ê·¸ë£¹ êµ¬ì„±

   EC2 ì¸ìŠ¤í„´ìŠ¤ë¡œ ë“¤ì–´ì˜¤ëŠ” íŠ¸ë˜í”½ì„ ê°€ì§ˆ ìˆ˜ ìˆë„ë¡

3. SSH(Secure Shell)ì„ í†µí•´ ì¸ìŠ¤í„´ìŠ¤ ì—°ê²°

   ë¦¬ëª¨íŠ¸ ë¨¸ì‹ ì— ì—°ê²°í•˜ê¸° ìœ„í•œ íŠ¹ì • ì ‘ê·¼ ë°©ì‹

```bash
docker build -t IMAGE_NAME .
docker run -d --rm --name CONTAINER_NAME -p 80:80 IMAGE_NAME
```

## ê°œë°œ í™˜ê²½ê³¼ í”„ë¡œë•ì…˜ í™˜ê²½ì˜ ì°¨ì´

- ê° í™˜ê²½ë§ˆë‹¤ `docker run` ëª…ë ¹ì—ì„œ ë‹¤ë¥¸ optionì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ë™ì¼í•œ Dockerfileì„ ì“¸ ìˆ˜ ìˆëŠ” ê²ƒì´ë‹¤. <br>â†’ í•­ìƒ ì •í™•íˆ ë™ì¼í•œ ì´ë¯¸ì§€ë¡œ ì‘ì—…í•˜ê³ , ê°œë°œ ì¤‘ì— ë” ë§ì€ ìœ ì—°ì„±ì„ ê°–ë„ë¡ ë³´ì¥í•  ìˆ˜ ìˆëŠ” ë°©ë²•

  > â“ ê° ë‹¨ê²Œë³„ë¡œ ëª…ë ¹ì–´ë¥¼ ë‹¤ë¥´ê²Œ ê°€ì ¸ê°€ëŠ” ê²Œ ì•„ë‹ˆë¼ Dockerfileì„ ë‹¤ë¥´ê²Œ ê°€ì ¸ê°€ëŠ” ê²Œ íœ´ë©´ ì´ìŠˆë¥¼ ì¤„ì¼ ìˆ˜ ìˆë‹¤ëŠ” ì ì—ì„œ ë” ë‚«ì§€ ì•Šë‚˜? ëª…ë ¹ì–´ ë¶ˆí¸í•´ì‡!<br>
  > í•­ìƒ ë™ì¼í•œ ì´ë¯¸ì§€ë¡œ ì‘ì—…í•˜ëŠ” ê±´ ëª…ë ¹ì–´ê°€ ë‹¬ë¼ì§€ë©´ ì˜ë¯¸ê°€ ì—†ëŠ” ë§ì´ì§€ ì•Šì„ê¹Œ... ì‹¶ë‹¤!

- í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•˜ëŠ” ìœ„ì¹˜ì— ê´€ê³„ ì—†ì´ ëª¨ë“  ì´ë¯¸ì§€ê°€ ì–´ë–¤ ì¶”ê°€ í™˜ê²½ êµ¬ì„±, ì½”ë“œì—†ì´ë„ ë™ì‘í•œë‹¤.

## EC2 ìƒì„± ë° SSH ì—°ê²°

1. ì´ë¯¸ì§€ í™˜ê²½ ì„¤ì •
2. ì¸ìŠ¤í„´ìŠ¤ ìœ í˜• ì„¤ì •
3. ë„¤íŠ¸ì›Œí¬ ì„¤ì •
4. í‚¤ í˜ì–´ ì„¤ì • ë° ì €ì¥
5. ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì™„ë£Œ

![01](./01-EC2-create-step.png)

```bash
chmod 400 "PEM_KEY_NAME.pem"

ssh -i "PEM_KEY_NAME.pem" ec2-user@{í¼ë¸”ë¦­ IPv4 DNS}
ex.
ssh -i "PEM_KEY_NAME.pem" ec2-user@ec2-43-201-109-10.ap-northeast-2.compute.amazonaws.com
```

## EC2ì— Docker ì„¤ì¹˜í•˜ê¸°

### ë¬¸ì œ ìƒí™©

`sudo amazon-linux-extras install docker`ê°€ ì§€ì›ë˜ì§€ ì•ŠìŒ

![](./02-amazon-linux-extras-problem.png)

### í•´ê²° ë°©ë²•

```bash
sudo yum update -y
sudo yum -y install docker
```

```bash
sudo service docker start
sudo usermod -a -G docker ec2-user
// ssh ë¡œê·¸ì•„ì›ƒ (ctrl + D)
```

![](./03-amazon-linux-extras-solution-01.png)

```bash
// ssh ì¬ë¡œê·¸ì¸
sudo systemctl enable docker
docker version
// ì„¤ì¹˜ í™•ì¸ ì™„ë£Œ
```

![](./04-docker-install-result.png)

## ì†ŒìŠ¤ì½”ë“œ ë°°í¬ vs ì´ë¯¸ì§€

option 1) ì†ŒìŠ¤ ë°°í¬

- í”„ë¡œì íŠ¸ í´ë”ì˜ ëª¨ë“  í•­ëª©ì„ ë¦¬ëª¨íŠ¸ ë¨¸ì‹ ì— ë³µì‚¬
- ë¶ˆí•„ìš”í•œ ë³µì¡í•œ ê²ƒì´ ë§ìŒ

option 2) ë¡œì»¬ ë¨¸ì‹ ì—ì„œ ë¯¸ë¦¬ ì´ë¯¸ì§€ ë¹Œë“œ

- êµ¬ì¶• ì´ë¯¸ì§€ë¥¼ ë¦¬ëª¨íŠ¸ ë¨¸ì‹ ì— ë°°ì¹˜

---

```bash
// lost host machine
docker build -t IMAGE_NAME .
docker tag IMAGE_NAME REPOSITORY_NAME
docker push REPOSITORY_NAME
```

```bash
// ssh
docker run -d --rm -p 80:80 REPOSITORY_NAME
```

### platform í˜¸í™˜ ë¬¸ì œ

- ì›ì¸: mac M1ê³¼ AWS ì¸ìŠ¤í„´ìŠ¤ ê°„ì˜ í˜¸í™˜ë¬¸ì œ

```text
The requested image's platform (linux/arm64/v8) does not match the detected host platform (linux/amd64/v3) and no specific platform was requested
```

### í•´ê²° ë°©ë²•

```bash
// AS-IS
docker build -t IMAGE_NAME .

// TO-BE
docker build -t --platform linux/amd64 IMAGE_NAME .
```

[ì°¸ê³ : [Docker] ì´ë¯¸ì§€ ë¹Œë“œ í”Œë«í¼ í˜¸í™˜ì„± ê´€ë ¨ ì—ëŸ¬ (linux/amd64) - msung99 velog](https://velog.io/@msung99/Docker-%EC%9D%B4%EB%AF%B8%EC%A7%80-%EB%B9%8C%EB%93%9C-%ED%94%8C%EB%9E%AB%ED%8F%BC-%ED%98%B8%ED%99%98%EC%84%B1-%EA%B4%80%EB%A0%A8-%EC%97%90%EB%9F%AC-linuxamd64)

- ì¸ë°”ìš´ë“œ í¬íŠ¸ ê·œì¹™ë„ ì§€ì •í•´ì£¼ê¸°
  ![](05-inbound-rules.png)

## í˜„ì¬ ì ‘ê·¼ ë°©ì‹ì˜ ë‹¨ì  - DIY ë°©ì‹

- ë¦¬ëª¨íŠ¸ ë¨¸ì‹ ì˜ êµ¬ì„±ì— ëŒ€í•œ ì±…ì„ì„ ê°€ì ¸ì•¼ í•œë‹¤.
- ì§ì ‘ ë³´ì•ˆ ê·¸ë£¹, ë„¤íŠ¸ì›Œí¬ë„ ê´€ë¦¬í•´ì•¼ í•œë‹¤.
- SSHing, SSH í†µí•´ ë¨¸ì‹  ì ‘ê·¼ ë“± ë°°í¬ ì‘ì—…ì ˆì°¨ê°€ ë³µì¡í•´ì§„ë‹¤.

â†’ ê·¸ë˜ì„œ ê´€ë¦¬í˜• ë¦¬ëª¨íŠ¸ ë¨¸ì‹ ì¸ ECS(Elastic Container Service)ê°€ ì¡´ì¬í•œë‹¤.<br>
â†’ ì „ì²´ ìƒì„± ê´€ë¦¬, ì—…ë°ì´íŠ¸, ëª¨ë‹ˆí„°ë§, ìŠ¤ì¼€ì¼ë§ì´ ë‹¨ìˆœí™”ëœë‹¤<br>
â†’ ì»¨í…Œì´ë„ˆ ë°°í¬ ë° ì»¨í…Œì´ë„ˆ ì‹¤í–‰ì´ ë” ì´ìƒ ë„ì»¤ ëª…ë ¹ìœ¼ë¡œ ìˆ˜í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤..!

## ECSì˜ 4ê°€ì§€ ë²”ì£¼

- ì»¨í…Œì´ë„ˆ
  - ìì²´ ì»¤ìŠ¤í…€ ì»¨í…Œì´ë„ˆ ì„ íƒ
    - ì»¤ìŠ¤í…€ ì»¨í…Œì´ë„ˆ ì •ì˜(ì´ë¦„/ì´ë¯¸ì§€/í¬íŠ¸ ë§¤í•‘/í™˜ê²½ ë³€ìˆ˜/ë¡œê¹…)
    - ECSê°€ ë‚˜ì¤‘ì— `docker run` ì„ ì‹¤í–‰í•˜ëŠ” ë°©ë²•ì„ ì§€ì •
- íƒœìŠ¤í¬ ì •ì˜
  - ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë¸”ë£¨í”„ë¦°íŠ¸.
  - AWSëŠ” ì‹¤ì œë¡œ ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•˜ëŠ” EC2 ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ì§€ ì•Šê³ , ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•˜ëŠ” ë°©ë²•ê³¼ ì»¨í…Œì´ë„ˆë¥¼ ìœ„í•´ ì–´ë–¤ í™˜ê²½ì„ ì„¤ì •í•´ì•¼ í•˜ëŠ”ì§€
  - ê¸°ë³¸ì ìœ¼ë¡œ FARGATEë¥¼ ì‚¬ìš©
    - ì»¨í…Œì´ë„ˆë¥¼ ì‹œì‘í•˜ëŠ” íŠ¹ì • ë°©ë²•(ì„œë²„ë¦¬ìŠ¤ ëª¨ë“œì—ì„œ êµ¬ë™)
    - AWSëŠ” ì‹¤ì œë¡œ ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•˜ëŠ” EC2 ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ì§€ ì•Šê³  ëŒ€ì‹  ì»¨í…Œì´ë„ˆì™€ ê·¸ ì‹¤í–‰ ì„¤ì •ì„ ì €ì¥
    - FARGATEë¥¼ EC2ë¡œ ì „í™˜í•˜ì—¬ AWSì— EC2 ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ë„ë¡ í•˜ëŠ” ê²ƒë„ ê°€ëŠ¥í•¨
    - ì»¨í…Œì´ë„ˆê°€ ì‹¤í–‰ ì¤‘ì¸ ì‹œê°„ì— ëŒ€í•´ì„œë§Œ ë¹„ìš© ì§€ë¶ˆí•œë‹¤ëŠ” ì ì—ì„œ íš¨ìœ¨ì ì„
- ì„œë¹„ìŠ¤
  - íƒœìŠ¤í¬ì™€ íƒœìŠ¤í¬ ë‚´ì˜ ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•˜ëŠ” ë°©ë²•ì„ ì œì–´
  - ë¡œë“œë°¸ëŸ°ì„œ ì¶”ê°€ ê°€ëŠ¥
- í´ëŸ¬ìŠ¤í„°
  - ì„œë¹„ìŠ¤ë¥¼ ì‹¤í–‰í•˜ëŠ” ë„¤íŠ¸ì›Œí¬

> ğŸ‘©â€ğŸ’» ê·¸ëŸ°ë° í˜„ì¬ AWS UIì—ì„œëŠ” ì»¨í…Œì´ë„ˆ, ì„œë¹„ìŠ¤ë¥¼ ë°”ë¡œ ì°¾ì„ ìˆ˜ ì—†ë‹¤... ìƒˆë¡­ê²Œ ì—…ë°ì´íŠ¸ëœ ìƒíƒœì—ì„œ ë‹¤ì‹œ ì‹¤ìŠµì„ í•´ì•¼í•  ê²ƒ ê°™ë‹¤.

[AWSì— ëŒ€í•œ ì¶”ê°€ ì •ë³´ - AWS VPC & Subnets | Amazon Web Services BASICS](https://www.youtube.com/watch?v=bGDMeD6kOz0)

## ECS ìƒì„± ë° ì„¤ì •

### pushëœ ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸í•˜ëŠ” ë²•

- cluster â†’ tasks â†’ ì‹¤í–‰ ì¤‘ì¸ task â†’ create new revision
  - ê°™ì€ íƒœìŠ¤í¬ ìƒì„±
- ë˜ëŠ” update service â†’ force new deployment

êµ¬ë™ë˜ëŠ” ìƒˆ íƒœìŠ¤í¬ ê°œì •íŒì— ëŒ€í•´ ìƒˆë¡œìš´ ê²ƒì„ ìƒì„±í•˜ê³  í• ë‹¹í•˜ê¸° ë•Œë¬¸ì— ipë„ ìƒˆë¡­ê²Œ ë°”ë€ë‹¤!

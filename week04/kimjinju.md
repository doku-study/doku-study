# 새롭게 알게된 점

## Containers & network requests
> WWW(world wide web) 통신
- 컨테이너화 된 앱에서 http요청을 다른 웹사이트나 웹 API로 전송해서 통신 
> 로컬 호스트 머신(host machine)으로의 통신
- 컨테이너화된 앱과 컨테이너외부의 무언가와의 통신
- 예를 들면, 로컬에 있는 자체 데이터베이스와 컨테이너의 연결 
> 컨테이너 간 통신 
- 예를 들어, SQL 데이터베이스 컨테이너와의 연결 

## WWW(world wide web) 통신 컨테이너
컨테니어화된 앱에 연결하고자 하는 다른 더미웹 API 연결 케이스 

- localhost:3000 접속 -> 성공! 더미 웹 repsonse 

`어떤 추가 설정 없이 월드와이드웹과 통신가능`

- 도커화된 애플리케이션 내부에서 웹API와 HTTP 통신이 가능하다.

## 로컬 호스트 머신으로의 통신
컨테이너화된 앱에 로컬에 있는 mongoDB에 연결 케이스 

> 로컬에 있는 몽고디비와 연결하는 주소는?

- mongodb://`localhost`:27017로 mongoDB 연결 -> 실패!
- mongodb://`host.docker.internal`:27017 로 연결 -> 성공! 

`"특수 도메인주소(host.docker.internal)"로 변경해야 로컬호스트머신과 통신가능`

- localhost를 도커 내부에서 이해할 수 있는 특수 도메인으로 변경 필요.
- 도커가 알아서 호스트머신의 ip주소로 변환되어 사용.
- 도메인이나 url이 필요한 어느곳에서 사용할 수 있음.


## 컨테이너간 통신
컨테이너화된 앱과 데이터베이스용 컨테이너(mongoDB) 간 연결 케이스

mongoDB 컨테이너 IP 확인 
- `docker container inspect mongodb` 
- NetworkSettings > IPAddress (ex:172.17.0.2)

> 또 다른 컨테이너에 있는 몽고디비와 연결하는 주소는?
- mongodb://`172.17.0.2`:27017 로 연결 -> 성공! 

`컨테이너의 "내부 IP"로 변경해야 컨테이너간 통신가능`

- 컨테이너 내부 IP를 한번더 확인해봐야함 
- 컨테이너 IP주소가 변경될때마다 매번 새 이미지 빌드
- 그래서 이렇게 직접 IP주소를 하드코딩하는 방식은 이상적이지 않음. 


## 이상적인 컨테이너간 통신 : 컨테이너 네트워크

> 모든 컨테이너가 서로 통신할 수 있는 네트워크 생성

컨테이너간 통신을 위한 내부 네트워크 생성

- `docker network create my_network`
- 도커에 의해 네트워크 설정 및 생성 
- 이전에 직접 했던 내부IP를 확인하는 작업을 도커가 자동으로 수행.

내부 네트워크 조회 
- `docker network ls`
- 커스텀 네트워크 뿐만 아니라 내장된 디폴트 네트워크 조회가능

내부 네트워크를 사용하는 mongoDB 컨테이너 실행 
- `docker run -d -name mongodb --network my_network`
- network 옵션 추가 
- 직접내가 컨테이너의 내부 IP를 확인하지 않아도 됌.
- 이떄, 포트를 노출하지 않아도 된다! 
    - 어차피 같은 네트워크간에 컨테이너간 연결이
    - 컨테이너 내부에서 서로 자유롭게 통신할 수 있기 때문에. 
    - 포트노출은 로컬이나 외부에서 컨테이너에 연결할때만 필요.

> 그럼, 다른 컨테이너에 있는 몽고디비와 연결하는 주소는?
- mongodb://`mongodb`:27017 로 연결 -> 성공! 

`"컨테이너 이름"으로 변경해야 컨테이너간 통신가능`
- 하드코딩하던 컨테이너의 내부 IP주소 대신 컨테이너 이름을 쓴다  
- 도커가 알아서 컨테이너 이름을 내부ip주소로 변환해서 사용

내부 네트워크를 사용하는 앱 컨테이너 실행
- `docker run --name favorites -network my_network -d --rm -p 3000:3000 favorites_app`
- network 옵션 추가 (mongodb와 같은 내부 네크워크로 연결)


## Docker가 IP주소를 해결하는 방법 
- 도커는 소스코드를 읽지 않는다.
- 컨테이너의 이름을 보고 컨테이너 IP주소와 연결한다. 
- 컨테이너에서 요청을 전송할때만 자동IP변환
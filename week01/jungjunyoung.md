## 도커와 컨테이너

* 컨테이너 : 코드 자체와, 코드를 실행하기 위한 종속성들이 함께 들어있는 패키지
* 도커 : 컨테이너를 생성하고 관리하는 도구

* 같은 컨테이너는 항상 같은 내용을 담고 있으므로, 언제 어디서 누가 실행하든 같은 결과를 기대할 수 있다.
  * ex: 최신 노드 버전에서만 제공하는 top-level await 기능이 들어있는 코드가 어디서든 동작할 수 있도록 보장한다.
* 모던 OS 에는 컨테이너 지원 기능이 내장되어 있다.



<br />



## 독립적이고, 표준화된 애플리케이션 패키지가 필요한 이유

* 같은 프로젝트를 개발함에도 불구하고, 서로 다른 환경을 가지고 있을 수 있으므로 항상 정상 작동함을 보장할 수 없음
  * 개발환경 <--> 프로덕션환경이 다를 수 있음
  * 같은 프로젝트를 개발하는 팀/회사 별로도 환경이 다를 수 있음
  * 프로젝트 간 전환할 때 기존 환경을 삭제하지 않아도 됨



<br />

## Virtual OS 가 각 컨테이너에 포함되지 않는 이유

* 장점
  * 분리된 환경
  * 해당 환경에 특화된 설정을 할 수 있음
  * 환경 설정을 공유하거나 재생산하기 쉬움
* 단점
  * 컨테이너마다 포함되는 OS 가 같거나 비슷하다면, 불필요한 중복이 생김
  * OS 자체가 무겁기 때문에, 성능이 저하될 수 있음
  * 다른 컴퓨터에서 컨테이너를 실행하기에 까다로울 수 있음

* 해결책

  * 모던 OS 에는 컨테이너에 대한 지원 기능이 내재되어 있으므로, 도커는 이 기능이 실행되도록 함

  

  

## 도커가 설치된 시스템 아키텍처

![system_architecture_with_docker_001](https://s3.ap-northeast-2.amazonaws.com/blog.resource/images/system_architecture_with_docker_001.jpeg)

> OS 가 컨테이너에 대한 지원 기능을 내장하고 있고, 그 위에서 도커 엔진이 실행된다.



<br />

## 도커 vs VM

|             | 도커                                                         | Virtual Machine                                             |
| ----------- | ------------------------------------------------------------ | ----------------------------------------------------------- |
| 영향        | OS 에 미치는 영향이 적으며, 빠르고, 최소한의 디스크 용량만 차지함 | OS 에 미치는 영향이 크며, 느리고, 많은 디스크 용량을 차지함 |
| 모듈성      | 공유, 재구축, 배포가 쉬움                                    | 공유, 재구축, 배포가 어려움                                 |
| 캡슐화 범위 | 앱 + 환경                                                    | 앱 + 환경 을 포함하고 있는 전체 컴퓨터 시스템               |





<br />

## 첫 Dockerfile 작성해보기

```dockerfile
# 컨테이너 내부에서 node 14 버전 사용
FROM node:14

# 컨테이너 내부의 /app 폴더를 사용
WORKDIR /app

# 로컬 프로젝트의 package.json 파일을 컨테이너 내부의 /app 폴더에 복사
COPY package.json .

# 로컬 프로젝트에서 npm install 명령 실행
RUN npm install

# 로컬 프로젝트의 모든 파일, 폴더를 컨테이너 내부의 /app 폴더에 복사
COPY . . 

# 컨테이너 네트워크의 3000 포트를 공개, 컨테이너의 애플리케이션에 접근할 수 있도록 함 (애플리케이션이 3000포트를 열어뒀다고 가정)
EXPOSE 3000

# node 명령으로 애플리케이션 실행
CMD ["node", "app.mjs"]
```









<br />

## 레퍼런스

https://www.udemy.com/course/docker-kubernetes-2022/